name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.x

    - name: Build
      run: |
        echo 'Building...'
        sh 'python --version'
        sh 'ls'
        sh 'pwd'
        sh '''
            cd Jenkins_Python_S107/flask/requirements/build.in
            build
          '''

    - name: Test
      run: |
        echo 'Testing...'
        sh '''
        python -m pip install --upgrade pip
        pip install asgiref greenlet python-dotenv
        pytest
        '''
        sh '''
            cd Jenkins_Python_S107/flask
            pytest
            '''
            archiveArtifacts 'Jenkins_Python_S107/flask/flash/tests'
      continue-on-error: true

    - name: Notifications
      run: |
        echo 'Notifications...'
        // Comandos de notificação aqui
        sh '''
        emailext (
                  to: 'destinatario@exemplo.com',
                  subject: 'Assunto da Notificação',
                  body: 'Corpo da Notificação',
                  )

        '''
        sh '''
        slackSend (
                   channel: '#canal',
                   color: 'good',
                   message: 'Mensagem de notificação no Slack',
                  )
        '''
        sh '''
        stage('Build') {
              steps {
                    // Seu processo de build
                    }
              post {
                  success {
                      echo 'O build foi bem-sucedido!'
                      // Adicione ações de notificação aqui
                  }
                 failure {
                      echo 'O build falhou!'
                      // Adicione ações de notificação aqui
                  }
              }
          }
'''
        sh'''
          stage('Minha Etapa Personalizada') {
              steps {
                  echo 'Notificação personalizada'
                  // Ou execute um script personalizado para notificação
                    }
            }
 '''